<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>kafka 2.x 部署 | ibiji</title>

<link rel="shortcut icon" href="https://ibiji.top/favicon.ico?v=1694489113997">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://ibiji.top/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
    
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            ibiji
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1694489113997"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    kafka 2.x 部署
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2023-09-12 ·
                    </time>
                    
                        <a href="https://ibiji.top/tag/TB4SSpygT/" class="post-tags">
                            # kafka
                        </a>
                    
                </div>
                <div class="post-content">
                    <p><strong>环境 centos7.x | jdk1.8.0_281 | kafka 2.12</strong></p>
<blockquote>
<p>附录一: zookeeper 完整配置内容;  附录二:kafka 完整配置内容</p>
</blockquote>
<h1 id="kafka-官网地址">kafka 官网地址</h1>
<pre><code class="language-url">https://kafka.apache.org/downloads
</code></pre>
<h1 id="安装">安装</h1>
<p>本文以kafka_2.12-2.8.2版本为例, 使用 kafka 自带zookeeper,  <a href="https://archive.apache.org/dist/kafka/2.8.2/kafka_2.12-2.8.2.tgz">kafka下载地址</a>, 默认读者已安装 jdk1.8</p>
<h2 id="下载">下载</h2>
<pre><code class="language-shell">wget https://archive.apache.org/dist/kafka/2.8.2/kafka_2.12-2.8.2.tgz
</code></pre>
<h2 id="解压">解压</h2>
<pre><code class="language-shell">tar -zxvf kafka_2.12-2.8.2.tgz
</code></pre>
<h2 id="zookeeper-配置">zookeeper 配置</h2>
<h3 id="创建myid-内容为-1">创建myid 内容为 1</h3>
<p>zookeeper 集群,  myid 按顺序编号 (例: 第一台 zookeeper为1, 第二台为2, 以此类推)</p>
<pre><code class="language-shell">vi /data1/data/zookeeper/myid
</code></pre>
<h3 id="修改配置文件">修改配置文件</h3>
<pre><code class="language-shell">vi kafka_2.12-2.8.2/config/zookeeper.properties
</code></pre>
<h4 id="修改-datadir">修改 <code>dataDir</code></h4>
<p>路径改为自己<code>myid</code>的路径</p>
<pre><code class="language-text">dataDir=/data1/data/zookeeper/
</code></pre>
<h4 id="新增以下内容">新增以下内容</h4>
<p>server.1 为第一台的 IP, 与myid相对应, server.2 依次类推</p>
<pre><code class="language-shell">tickTime=2000
initLimit=10
syncLimit=5

server.1=10.1.5.15:2888:3888
server.2=10.1.5.16:2888:3888
server.3=10.1.5.31:2888:3888
</code></pre>
<h2 id="kafka-配置">kafka 配置</h2>
<h3 id="修改配置文件-2">修改配置文件</h3>
<pre><code class="language-shell">vi kafka_2.12-2.8.2/config/server.properties
</code></pre>
<h4 id="修改节点信息">修改节点信息</h4>
<p>1、修改<code>broker.id</code> 按照顺序编号, 1、2 以此类推</p>
<pre><code class="language-shell">broker.id=1
</code></pre>
<p>2、修改 <code>listeners</code></p>
<pre><code class="language-shell">listeners=PLAINTEXT://10.1.5.15:9092
</code></pre>
<p>3、参数优化</p>
<pre><code>num.network.threads=16
num.io.threads=160
log.flush.interval.messages=10000
log.flush.interval.ms=1000
log.retention.hours=72
</code></pre>
<p>4、修改<code>zookeeper.connect</code></p>
<pre><code class="language-shell">zookeeper.connect=10.1.5.15:2181,10.1.5.16:2181,10.1.5.31:2181,10.1.5.32:2181
</code></pre>
<p>5、新增内容<br>
host.name为<code>本机IP</code></p>
<pre><code>auto.create.topics.enable=false
delete.topic.enable=true
message.max.bytes=10485760
compression.type=producer
host.name=10.1.5.15
</code></pre>
<h1 id="启动服务">启动服务</h1>
<h2 id="启动zookeeper">启动zookeeper</h2>
<p>先启动zookeeper, 启动后<code>jps</code>命令查看进程, <em><strong>QuorumPeerMain</strong></em> 存活,且日志<code>logs/zookeeper.out</code> 没有错误</p>
<pre><code class="language-shell">./bin/zookeeper-server-start.sh -daemon ./config/zookeeper.properties
</code></pre>
<h2 id="启动kafka">启动kafka</h2>
<p>启动后<code>jps</code>命令查看进程, <em><strong>kafka</strong></em> 存活,且日志<code>logs/server.log</code> 没有错误</p>
<pre><code class="language-shell">./bin/kafka-server-start.sh -daemon ./config/server.properties
</code></pre>
<h1 id="停止服务">停止服务</h1>
<h2 id="停止-zookeeper">停止 zookeeper</h2>
<pre><code class="language-shell">./bin/zookeeper-server-stop.sh
</code></pre>
<h2 id="停止-kafka">停止 kafka</h2>
<pre><code class="language-shell">./bin/kafka-server-stop.sh
</code></pre>
<h1 id="附录一">附录一:</h1>
<pre><code># Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the &quot;License&quot;); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# the directory where the snapshot is stored.
dataDir=/data2/data/zookeeper2
# the port at which the clients will connect
clientPort=2181
# disable the per-ip limit on the number of connections since this is a non-production config
#maxClientCnxns=0
# Disable the adminserver by default to avoid port conflicts.
# Set the port to something non-conflicting if choosing to enable this
admin.enableServer=false
# admin.serverPort=8080

tickTime=2000
initLimit=10
syncLimit=5

server.1=10.1.5.15:2888:3888
server.2=10.1.5.16:2888:3888
server.3=10.1.5.31:2888:3888
server.4=10.1.5.32:2888:3888
server.5=10.1.5.46:2888:3888
server.6=10.1.5.47:2888:3888
server.7=10.1.5.48:2888:3888
server.8=10.1.5.64:2888:3888
</code></pre>
<h1 id="附录二">附录二:</h1>
<pre><code># Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the &quot;License&quot;); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# see kafka.server.KafkaConfig for additional details and defaults

############################# Server Basics #############################

# The id of the broker. This must be set to a unique integer for each broker.
broker.id=1
listeners=PLAINTEXT://10.1.5.15:9092
############################# Socket Server Settings #############################

# The address the socket server listens on. It will get the value returned from
# java.net.InetAddress.getCanonicalHostName() if not configured.
#   FORMAT:
#     listeners = listener_name://host_name:port
#   EXAMPLE:
#     listeners = PLAINTEXT://your.host.name:9092
#listeners=PLAINTEXT://:9092

# Hostname and port the broker5will advertise to producers and consumers. If not set,
# it uses the value for &quot;listeners&quot; if configured.  Otherwise, it will use the value
# returned from java.net.InetAddress.getCanonicalHostName().
#advertised.listeners=PLAINTEXT://your.host.name:9092

# Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details
#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL

# The number of threads that the server uses for receiving requests from the network and sending responses to the network
num.network.threads=16

# The number of threads that the server uses for processing requests, which may include disk I/O
num.io.threads=160

# The send buffer (SO_SNDBUF) used by the socket server
socket.send.buffer.bytes=102400

# The receive buffer (SO_RCVBUF) used by the socket server
socket.receive.buffer.bytes=102400

# The maximum size of a request that the socket server will accept (protection against OOM)
socket.request.max.bytes=104857600


############################# Log Basics #############################

# A comma separated list of directories under which to store log files
log.dirs=/data1/data/kafka2,/data2/data/kafka2,/data3/data/kafka2,/data4/data/kafka2,/data5/data/kafka2,/data6/data/kafka2,/data7/data/kafka2,/data8/data/kafka2,/data9/data/kafka2

# The default number of log partitions per topic. More partitions allow greater
# parallelism for consumption, but this will also result in more files across
# the brokers.
num.partitions=1

# The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.
# This value is recommended to be increased for installations with data dirs located in RAID array.
num.recovery.threads.per.data.dir=1

############################# Internal Topic Settings  #############################
# The replication factor for the group metadata internal topics &quot;__consumer_offsets&quot; and &quot;__transaction_state&quot;
# For anything other than development testing, a value greater than 1 is recommended to ensure availability such as 3.
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1

############################# Log Flush Policy #############################

# Messages are immediately written to the filesystem but by default we only fsync() to sync
# the OS cache lazily. The following configurations control the flush of data to disk.
# There are a few important trade-offs here:
#    1. Durability: Unflushed data may be lost if you are not using replication.
#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.
#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.
# The settings below allow one to configure the flush policy to flush data after a period of time or
# every N messages (or both). This can be done globally and overridden on a per-topic basis.

# The number of messages to accept before forcing a flush of data to disk
log.flush.interval.messages=10000

# The maximum amount of time a message can sit in a log before we force a flush
log.flush.interval.ms=1000

############################# Log Retention Policy #############################

# The following configurations control the disposal of log segments. The policy can
# be set to delete segments after a period of time, or after a given size has accumulated.
# A segment will be deleted whenever *either* of these criteria are met. Deletion always happens
# from the end of the log.

# The minimum age of a log file to be eligible for deletion due to age
log.retention.hours=72

# A size-based retention policy for logs. Segments are pruned from the log unless the remaining
# segments drop below log.retention.bytes. Functions independently of log.retention.hours.
#log.retention.bytes=1073741824

# The maximum size of a log segment file. When this size is reached a new log segment will be created.
log.segment.bytes=1073741824

# The interval at which log segments are checked to see if they can be deleted according
# to the retention policies
log.retention.check.interval.ms=300000

############################# Zookeeper #############################

# Zookeeper connection string (see zookeeper docs for details).
# This is a comma separated host:port pairs, each corresponding to a zk
# server. e.g. &quot;127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002&quot;.
# You can also append an optional chroot string to the urls to specify the
# root directory for all kafka znodes.
zookeeper.connect=10.1.5.15:2181,10.1.5.16:2181,10.1.5.31:2181,10.1.5.32:2181,10.1.5.46:2181,10.1.5.47:2181,10.1.5.48:2181

# Timeout in ms for connecting to zookeeper
zookeeper.connection.timeout.ms=18000


############################# Group Coordinator Settings #############################

# The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.
# The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.
# The default value for this is 3 seconds.
# We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.
# However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.
group.initial.rebalance.delay.ms=0

auto.create.topics.enable=false
delete.topic.enable=true
message.max.bytes=10485760
compression.type=producer
host.name=10.1.5.15
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://ibiji.top/post/1634912185907532/" class="post-title gt-a-link">
                    CentOS7 部署 SuperSet
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">❤️</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        ibiji
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://ibiji.top/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
